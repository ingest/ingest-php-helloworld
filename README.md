# Ingest PHP SDK Code Samples

Hello world! As mentioned in the main documentation, there are two ways of generating an API access token: either use the Personal Access Tokens generated by the Ingest Developer Centre, which are long-lived and tied to your account, or ask the user for permission to access their account, which will generate a short-lived token tied to their account.

If you are using a PAT you've already generated, you can skip down to _Using a token_. Otherwise, continue on.

## Acting on a user's behalf

The first step in your app generating a token that will allow you to act on a user's behalf is to redirect them to a URL similar to the below:

```
https://login.ingest.info/authorize?response_type=code&client_id=uCA3YHTPDxoKB7YTmM2U&scope=read_videos
```

They will then log in, authorizing you to access their account. After a successful login, Ingest will redirect them to the URI you set in your Developer Centre settings, with a query string appended. It will look something like:

```
https://yourwebsite.com/your-ingest-subfolder?code=c3HWRTA-QimPeHtcQD7IeQ&state=1a82a6bb-fa72-4218-a3e4-3861b2fbc2ce
```

You should then grab that code off of the query string, and send a POST to Ingest requesting to exchange this code (which can only be used once) for a standard access token in JWT format. So the index.php file inside your-ingest-subfolder could look something like:

```
<?php

$queryString = filter_input(INPUT_SERVER, 'QUERY_STRING', FILTER_SANITIZE_STRING);

parse_str($queryString, $queryString);

$code = $queryString["code"];

// Construct a URL to POST to, containing the code you were just given.
$curl = curl_init("https://login.ingest.io/token?grant_type=authorization_code&client_id=uCA3YHTPDxoKB7YTmM2U&client_secret=PtecpEMxPAQ14pHQQHe5JLvTD2v2sAU&code={$code}");

curl_setopt($curl, CURLOPT_POST, true);

// Ensure that the data is returned to your program, not written to the server console.
$curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);

$response = json_decode(curl_exec($curl));

$token = $response->access_token;
```

Now that you have a token allowing you to act on a user's behalf, let's use it!

## Using a token

_This information comes from the main SDK documentation, and may be out of date. If so, please file an issue and we will update it right away._

_Once you are up and running, are we encourage you to read the entire documentation available at https://github.com/ingest/ingest-php-sdk._

_Thanks!_

### Installation

Importing our SDK into your PHP project is super easy with Composer (https://getcomposer.org). Just run the following command:

```
composer require ingest/php-sdk
```

and you're done!

### Instantiating an Object

The files are laid out similarly to the Ingest API itself, and are fully PSR-4 namespaced, so you should be able to autoload them fairly easily with Composer. To create a Video object *(or an Input, or a Profile, or any other object)* for your use:

```
<?php

require dirname(__DIR__) . '/vendor/autoload.php';

use \IngestPHPSDK\videos\Video;

$version = "application/vnd.ingest.v1+json";

$accessToken = "your.access_token.here";

$video = new Video($version, $accessToken);

$allVideos = $video->getAll();
```

This code would then return a list of all videos available to you, via the Ingest API. The response would be an associative array, with three elements:

* status
* headers
* content

**status** contains a string like *HTTP/1.1 200 OK*.

**headers** contains an associative array with an arbitrary number of elements. These elements have the header's name (like *Content-Type*) as the key, and the header's value (like *application/json*) as the value.

**content** contains whatever the API returned as the body of the response. Ingest sends the body as JSON, but the SDK decodes it to its PHP datatype, be that a string, an object, or an array. Of course, if it's an object or an array, it may contain other objects, strings, or arrays. Please check the Ingest documentation so you know what to expect.

If there was an authentication error, this will be reported to you in the **status** and **content** fields. There may also be information in the **headers** for some errors, like trying to query the API too often.

## More Information

We'd love to tell you more about what our SDK can do for you, at https://github.com/ingest/ingest-php-sdk.

See you there!
